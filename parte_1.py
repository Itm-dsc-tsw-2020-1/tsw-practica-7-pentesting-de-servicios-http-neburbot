import os
import mysql.connector as mysql
import requests
from urllib.request import urlopen

def obtenerHTML(host):
    url ='http://' + host +'/php_tiendita_login/index.html'
    print(url)
    peticion = requests.get(url)
    print("\nPetición HTTP")
    print("\nSitio: "+ str(peticion.url))
    print("Codigo de operación: "+ str(peticion.status_code))
    print("Codigo del sitio: \n" + str(peticion.text))
    if(str(peticion.status_code)==200):
        hosts.append(host)
    f = open (host + '.txt', 'w')
    f.write(str(peticion.text))
    f.close()

hosts = []
conexion = mysql.connect( host = 'localhost', user = 'root', passwd = '', db = 'nmap' )
operacion = conexion.cursor()
operacion.execute( "SELECT direccion FROM puerto WHERE servicio = 'http';")
for ip in operacion.fetchall() :
    print (ip)
    host = str(ip[0])
    try:
        obtenerHTML(host)
    except:
        print("No fue posible realizar la petición a: " + host)
conexion.close()